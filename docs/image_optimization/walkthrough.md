# 画像ハンドリングの最適化とメモリクラッシュ対策の完了

`main.json` の肥大化によるメモリ不足とクラッシュを解消するため、以下の改善を行いました。

## 実施した主な変更

### 1. データ構造の最適化
- **既存画像の抽出**: `main.json` に埋め込まれていた巨大な Base64 データを `assets/images/` ディレクトリにファイルとして抽出しました。
- **軽量化**: `main.json` のサイズを **5.7MB** から **約3KB** に削減しました。これにより、読み込み速度と編集時の動作が劇的に改善されました。

### 2. コンテンツ管理画面（contents-manager.html）の修正
- **クライアントサイド・リサイズ**: 画像アップロード時にブラウザ上で自動的にリサイズ（最大1600px）と圧縮（品質0.8）を行うようにしました。
- **ファイルベース保存**: 新しくアップロードした画像も、Base64 として JSON に埋め込むのではなく、個別の画像ファイルとして GitHub に保存されるように変更しました。
- **スロット追加**: `reason01Bg` 〜 `reason03Bg` も管理画面から変更可能にしました。

### 3. 保存用API（gcp-save-api）の更新とデプロイ
- **バイナリ対応**: バイナリデータ（Base64文字列）を直接ファイルとして保存できるよう、Cloud Functions のコードを修正しました。
- **デプロイ完了**: 新しいコードを Google Cloud Functions（`saveContent`）にデプロイ済みです。直ちに変更内容が反映されます。

## 検証結果
- `main.json` の読み込みが瞬時に完了することを確認。
- 画像が `assets/images/` から正しく読み込まれること。
- 画像のリサイズ機能により、アップロード後のプレビュー表示が高速化されたこと。
- 「保存してデプロイ」を実行し、画像ファイルと JSON が GitHub へ個別にアップロードされるフローを確認済み。


## おわりに
これで、画像の肥大化によるメモリ問題は解決されました。今後管理画面から画像をアップロードする際は、自動的にリサイズされ、リポジトリ内の `assets/images/` に個別のファイルとして保存されるようになります。
